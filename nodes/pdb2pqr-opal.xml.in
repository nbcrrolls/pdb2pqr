<?xml version="1.0" standalone="no"?>

<kickstart>

        <description>
        PDB2PQR
        </description>

        <copyright>
        </copyright>

        <changelog>

        </changelog>

        <package>pdb2pqr-opal</package>
        <package>zsi</package>

<post>



#
# fix pdb2pqr web site directories
#
if [ -e /var/www/html/pdb2pqr ] ; then
   rm -rf /var/www/html/pdb2pqr
fi
mkdir -p /var/www/html/pdb2pqr
<file name="/var/www/html/pdb2pqr/index.html" vars="expanded">
<![CDATA[
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>Your Page Title</title>
<meta http-equiv="REFRESH" content="0;url=/pdb2pqr_PDB2PQRVER/"></HEAD>
<BODY>
Redirecting to latest pdb2pqr 1.8...
</BODY>
</HTML>
]]>
</file>



if [ ! -d /var/tmp/pdb2pqr/tmp ]; then
    mkdir -p /var/tmp/pdb2pqr/tmp
    chmod 777 /var/tmp/pdb2pqr/tmp
fi

#
# fix the hostname
#
tempname="rollhost"
SERVER_NAME="&opal_public_fqdn;"
if [ "$SERVER_NAME" == "" ] ; then
        #if this is a frontend installation the
        #opal_public_fqdn is not set yet
        SERVER_NAME="&Kickstart_PublicHostname;"
fi
change_list=`grep -r -l $tempname /opt/pdb2pqr_*`
for i in $change_list; do \
  sed -i "s/$tempname/$SERVER_NAME/g" $i; \
done


#
# deploy opal services
#
if [ -d /opt/opal ]; then
<file name="/opt/opal/deployed/deploy.sh" mode="append">
#
# pdb2pqr
#
VERSION=1.8
pqb2pqr_script=/opt/pdb2pqr_$VERSION/pdb2pqr.py
if test -e $pdb2pqr_script; then
    $ANT -f $OPALXML deploy -DserviceName=pdb2pqr_$VERSION -DappConfig=$OPALCONFIG/pdb2pqr_$VERSION.xml
fi

VERSION=1.7.1a
pqb2pqr_script=/opt/pdb2pqr_$VERSION/pdb2pqr.py
if test -e $pdb2pqr_script; then
    $ANT -f $OPALXML deploy -DserviceName=pdb2pqr_$VERSION -DappConfig=$OPALCONFIG/pdb2pqr_$VERSION.xml
fi

</file>
fi

</post>
</kickstart>

