<?xml version="1.0" standalone="no"?>

<kickstart>

        <description>
        PDB2PQR
        </description>

        <copyright>
        </copyright>

        <changelog>

        </changelog>

        <package>pdb2pqr-opal</package>

<post>



#fix pdb2pqr web site
if [ -e /var/www/html/pdb2pqr ] ; then
   rm -rf /var/www/html/pdb2pqr
   fi
   ln -s /opt/pdb2pqr_PDB2PQRVER /var/www/html/pdb2pqr

if [ -e /opt/pdb2pqr ] ; then
   rm -rf /opt/pdb2pqr
   fi
   ln -s /opt/pdb2pqr_PDB2PQRVER /opt/pdb2pqr


if [ ! -d /var/tmp/pdb2pqr/tmp ]; then
    mkdir -p /var/tmp/pdb2pqr/tmp
        chmod 777 /var/tmp/pdb2pqr/tmp
        fi

tempname="rollhost"
SERVER_NAME="&opal_public_fqdn;"
if [ "$SERVER_NAME" == "" ] ; then
        #if this is a frontend installation the
        #opal_public_fqdn is not set yet
        SERVER_NAME="&Kickstart_PublicHostname;"
fi
change_list=`grep -r -l $tempname /opt/pdb2pqr_1.8`
for i in $change_list; do \
  sed -i "s/$tempname/$SERVER_NAME/g" $i; \
done


#deploy services
if [ -d /opt/opal ]; then
<file name="/opt/opal/deployed/deploy.sh" mode="append">
pqb2pqr_script=/opt/pdb2pqr_PDB2PQRVER/pdb2pqr.py
if test -e $pdb2pqr_script; then
    $ANT -f $OPALXML deploy -DserviceName=pdb2pqr_PDB2PQRVER -DappConfig=$OPALCONFIG/pdb2pqr_PDB2PQRVER.xml
fi
</file>
fi

</post>
</kickstart>

